# ProgenPHP Main .htaccess Configuration

# Enable rewrite engine
RewriteEngine On

# Redirect all requests to public folder (if not already there)
# This ensures that the public folder serves as the web root
RewriteCond %{REQUEST_URI} !^/public/
RewriteCond %{REQUEST_URI} !^/tests/
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)$ public/$1 [L]

# Security: Block access to sensitive files and directories
<FilesMatch "(^#.*#|\.(bak|config|dist|fla|inc|ini|log|psd|sh|sql|sw[op])|~)$">
    Order allow,deny
    Deny from all
    Satisfy All
</FilesMatch>

# Block access to version control directories
RedirectMatch 404 /\.git
RedirectMatch 404 /\.svn
RedirectMatch 404 /\.hg

# Prevent access to PHP files in private directory
<DirectoryMatch "^.*/private/.*">
    Order deny,allow
    Deny from all
</DirectoryMatch>

# Security headers (if mod_headers is available)
<IfModule mod_headers.c>
    Header always set X-Content-Type-Options nosniff
    Header always set X-Frame-Options SAMEORIGIN
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
</IfModule>